;; this is a spec sheet for practical human, iteration 0
;; using clojure, ring, and whatever other goodies will do the trick
;; like mongodb

specs:

A: posts can be made (blurbs)
  which have unique, short (3-6 char) ids using the characters:
    a b c d e f g h j k m n p q r s t u v w x y z [confusing ones omitted]
    A B C D E F G H J K M N P Q R S T U V W X Y Z
    2 3 4 5 6 7 8 9
  (notice: zeros, ones, L's [ells] and i's [eyes] are omitted)

posts have four delineations:
 - minor edits (spelling, spacing) -- although nonconventional language is OK!
  [sometimes the insight is in the irregularity]
 - totally new
 - comments to already-posted blurbs [which have tree-structure arrangements]
 - alternates [blurbs which 'compete' to replace pre-existing blurbs in the article running]

B: user accounts can be requested (login with your e-mail always, password only necessary if you want to post or double-up, upvote, or 'needs-work' something
 B* : figure out ssh secure logins for people who never want to login and always use the same machine.  maybe some super simple pattern matching game just to act as a last-ditch effort against compromised machine access.

C: posts can have tags upon creation, automatically derived tags, tag suggestions, and additional tags added by users with sufficient "trust" which has both a linear (monotonically increasing value) and a relative (0-99) value

D: articles are automagically derived from blurbs, ratings, and tags.

E: sparky, the seminal database of understanding -- to lead to human beneficial Derived Intelligence


pages to create:

/goodhello
/signin
/login

/post/blurb:id
 or /p/b:id

/edit/blurb
 /e/b

/blurb:id
 /b:id

/comment:id
 /c:id

/edit/comment:id
 /e/c:id

/post/comment:b:id (id of the blurb)
 /p/c:b:id

/article:id
 /a:id

/logout
/signout
/exit
/goodbye  [all active pages, meaning: invoking the URL logs you out.]

/global [for the world- and group- overviews]
/local

/cycle [envisioned as a bicycling group, you have an in-group chat/message board but it's really just a pin/and/comment board for blurbs that your group finds]

/switch [changing your cycling team is possible and easy, but is limited to once a week]

(maybe make /user indicies, but it's not really meant for that sort of interacting)

/user (edit basic info about your account, including your e-mail, password, see your own personal stats)

/settings (general settings page)

/revenue [the top ticker can be rented on a 12 min basis .. the current price ranges from $1 to ___, where ___ is whatever the demand blasts it into.  schedule of availability tracks up to 3 months in advance]


 --some potential table arrangements:

blurbs: content, summary-line-short, summary-line-long, rating
 hidden information (not visible to users): authors, people who rated it, what they rated it

users: stores userEmail, current userId, all past userIds and times of change, all ratings (correctness in redundancy)
(and i suppose password hashes for when they're necessary)


articles: simple aggregations of blurbs, their orders

tags: all the different tags [need a min level of trust to make new ones, free to use currently existing ones, also option to "ask" higher trust users to instantiate some for you.]

tag-relatedness: derived by sparky, built up incrementally. typically phase 2 of the project.  article generation being phase 3


//Updated February 4.2015

:split pages into component pieces for enlive.
(pre-header)
(header)

  (leftwrap)
  (blurbpool)
  (briefpool)

(footer stuff)

each component will return a list of enlive-html/emit* strings ... combine them all for a complete html page :D


@TODO: make a simple post page
       play it nicely with monger + mongodb

@TOdo: make user account signup
      
passwordless login (e-mail a secure link) seems to be the best way for now. 
more on passwordless logins in Ze Future!

user inter-behaviors:
              + depth restrictions on comment threads for new users to join.  meaning: if there is a comment thread,
              at first, people can post comments and join 'willy nilly' but after a depth of 3 or 4 perhaps the ability to
              comment is restricted to those "in the conversation" and those with sufficient rep..  i think this is a great idea, as it naturally discourages hijacking of threads and conversations, and more "real talk" can get done.

              funny ideas: users can pay $5 to set their display name.  otherwise it's an automagically generated string, maybe some numbers, maybe some leet speak.  
              

//Updated Feb 17.2015

if the user wants to change their e-mail later, there could be an easy way to re-associate existing user information with the new account -- offer some sort of easy migration link (also verifiable by e-mail)

... easily rectified by forcing all characters to lowercase!  go gravatar! (and trim whitespace)


/// Updated Feb. 18.2015

case-insensitive e-mail logins = mucho importante.

also, inspired by noir-auth-app, there could be a :key in the :session values to do automagic redirects upon requested pages on login.  so a middleware that not only checks if the user is logged in, but will also set a redirect value in case the user wanted a page but was not logged in yet = convenient! =)



///updated feb 21.2015
   switch to REDIS for database ... mongo (monger) open way too many connections...
   just loading the sample blurb list (12 blurbs) creates 24 connections... 
   so either figure out how to do mongo pools or
   just switch to redis, which looks like the more sophisticated and healthier opt.

///updated Feburary 28.2015

Datomic is the way. (for the db)

Datalog is cool -- still learning it.  learndatalogtoday.com is very useful with interactive examples

so the tuples that we end up with in the db for phase 1 will look like:

[blurb/title blurb/content  useremail]

[brief/title brief/content  useremail]

(omitting the implied datomic-id and time)
&

[blurb/tag useremail]

[brief/tag useremail]


so the next phase will require something like

[useremail, tag 1, tag 2, similarity]

and also, for convenience in accessing specific blurbs and briefs, (and eventually articles) there should be a hashing function like apple-hash that omits 1, I, L, and 0, O, (similar looking letters and numbers) and be short -- ideally 5 characters 


.|.|.| Updated March 3.2015  <3 |.|.|.

-> get a function that goes from easy-read-apple-hash to eid for datomic
e.g. az5529p -> 1222507360005 (dunno exact constraints but it should be fun!)

-> green spiral notebook has some good work:
   [all blurbs] -> [active blurb set from (t1, t2)] -> [article blurbs (crystalizes)]

so the active blurb set is the sum of blurbs within the time window,
 +regular users see a subset (of 9 at a time)
 +additive refresh [meaning that refreshing the page adds new "slides" instead of changing the apparent blurbs]... in case someone wants to add more to the output but also wants to comment or rate or tag an old one (so as not to lose the dataset... also consider 2dimensional map of the active blurb area with a movable window -- as per original whiteprints and blueprints and purpleprints)

 .|. update in the evening:
     so thanks to justin_smith on #Clojure, seems best to generate a random shortID for blurbs/briefs when putting them into the DB and incrementally raise it, otherwise, trying to hash the eid of entities will lead to collisions and then wht.  Simpler to add an Id as we go, and it can be 6-9 alphanumeric [applehash] meaning that it won't have confusing duplicate symbols like 1 and L, I, l, q, p, 0, O, o.  Notebook count leads me to 52 unique "digits" [think #ab22e9 hexadecimal] ... call it... joxadecimal?  hex times steve jobs = jox? shrug.
 A B C D E F G H J K L M N P Q R S T U V W X Y Z = 24
 a b c d e f g h   k   m n     r s t u v w x y z = 20
                                 2 3 4 5 6 7 8 9 =  8
                                     ----------------   
                                            52 digits

So, even something short like 3 joxadecimal digits can be 3^52 in variety 
                                                   = (* 52 52 52) = 140608

                                              6^52 = 19 770 609 664      or 19.7 billion

so a nice way to do a "nexthashavailable" function [is desirable].
  maybe it looks up the most recent joxadecimal write to the database and then increments it by 1.


//specsheet, updated march 5th, 2015, approq 3:23 pm.  sunny out aww yeahhhhhh :D

gosh i love that girl so much.

so finally there is a simple page to post blurbs to the db, which is great. Navigate to it via /post.
Not sure where to put "post" links yet.  Top bar?  blueprints and whiteprints point to the usercard area. Might be ideal, keep the top bar empty except for the ticker.  Focal points... goal!!

So anyway. There are things to be done for full completion, but i'm really pleased with the progress so far, and none of it would have been possible without rich hickey having the foresight to step back and realize that lisp is the way.  (=

oh yeah! what I really opened up the specsheet to write was: multilang support.

Keep that in the vision... japanese and korean to start would be great, as they are monospaced (yes!!!) and also of a reasonable difficulty that other language implementations would be rather straightforward, until we get to arabic.  eugh lol.  Na that language is beautiful too, but man, cursivey scripto on computers is like asking for a foot massage from a brick laying robot.

Also, now that I'm actually coercing myself to input a cool gem of wisdom or knowledge or poetry every time I test my posting capabilities, I'm starting to see what ph is actually good for.  Soon I'd like to add a way to do simple melody tracking / scores / loops .. musical blurb entries.  Like soundcloud-ish bits and pieces but with a visual component that lets people overlap them and stuff.  Lot of potential there for collaborative simple loops.  A lot comes into play but it's great to have a sense of direction.

So in general:  nihongo, kankokugo (hangul), english, and the rest can follow easily for the most part.  oo tibetan!  that will be awesome.

topics/areas/fields .. yeah fields.. that i'm thinking will be good: lol "i" ... 
   music
  dharma
   wisdom quotes
   poetry/ku
   photographs (which can be rated but take up the whole box.. add some beauty to the ninetile)
   

  and of course, any practical or fun knowledge that people can dig.  all about the dig.s

//march 8.2015
 getting blurbs from the database can return errors because of malformed urls (people put it "not numbers" like ~~~ ... numbers will always try and get a result but can come back blank.  so maybe a "no such entry" page would be good for both cases.


//march 9.2015
may melissa and nick's union be wonderful and magnetic always!


rehash a bit of the style to get a more bright-gate feel
